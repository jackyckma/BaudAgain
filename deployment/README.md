# BaudAgain BBS Deployment Guide

## Overview

This directory contains scripts and configurations for deploying BaudAgain BBS to a production server.

## Quick Deployment to DigitalOcean

### Prerequisites

- DigitalOcean droplet with Ubuntu 22.04 or similar
- SSH access configured (e.g., `do-dev` in your SSH config)
- Node.js 20+ and npm 10+ installed on the droplet

### Step 1: Build Deployment Package Locally

```bash
# From project root
cd deployment
./deploy.sh
```

This creates `baudagain-deploy.tar.gz` with everything needed for deployment.

### Step 2: Copy to Server

```bash
# Using your SSH config
scp baudagain-deploy.tar.gz do-dev:/tmp/

# Or with explicit host
scp baudagain-deploy.tar.gz user@your-server-ip:/tmp/
```

### Step 3: Setup on Server

```bash
# SSH into server
ssh do-dev

# Create deployment directory
mkdir -p ~/baudagain
cd ~/baudagain

# Extract package
tar -xzf /tmp/baudagain-deploy.tar.gz

# Run setup script
./setup-server.sh
```

The setup script will:
1. Check Node.js and npm versions
2. Install PM2 if needed
3. Create `.env` file with generated JWT secret
4. Prompt you to configure ANTHROPIC_API_KEY
5. Install dependencies
6. Start the server with PM2

### Step 4: Configure Environment

Edit `.env` file on the server:

```bash
nano .env
```

Required settings:
- `ANTHROPIC_API_KEY` - Get from https://console.anthropic.com
- `JWT_SECRET` - Already generated by setup script
- `CORS_ORIGIN` - Update if using web clients

### Step 5: Verify Deployment

```bash
# Check server status
pm2 status

# View logs
pm2 logs baudagain

# Test health endpoint
curl http://localhost:3000/api/v1/system/health
```

## Files Included

- `deploy.sh` - Builds and packages the application locally
- `setup-server.sh` - Configures and starts the server on deployment
- `ecosystem.config.js` - PM2 process manager configuration
- `README.md` - This file

## PM2 Commands

```bash
# Start
pm2 start ecosystem.config.js

# Stop
pm2 stop baudagain

# Restart
pm2 restart baudagain

# View logs
pm2 logs baudagain

# Save PM2 configuration
pm2 save

# Setup auto-start on reboot
pm2 startup
```

## Nginx Configuration (Optional)

To serve the application via Nginx:

```nginx
server {
    listen 80;
    server_name yourdomain.com;

    # WebSocket support
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

## Troubleshooting

### Server won't start

1. Check logs: `pm2 logs baudagain`
2. Verify `.env` file exists and has required variables
3. Check Node.js version: `node -v` (should be 20+)

### AI features not working

1. Verify `ANTHROPIC_API_KEY` is set in `.env`
2. Test API key validity
3. Check logs for API errors

### WebSocket connection fails

1. Check firewall settings
2. Verify PORT is accessible
3. Check CORS_ORIGIN settings

## Directory Structure

After deployment:

```
~/baudagain/
├── server-dist/          # Compiled server code
├── terminal-dist/        # Terminal client build
├── control-panel-dist/   # Control panel build
├── data/                 # Database and ANSI art
│   ├── ansi/
│   └── server/
├── node_modules/         # Production dependencies
├── logs/                 # PM2 logs
├── .env                  # Environment configuration
├── config.yaml           # BBS configuration
├── ecosystem.config.js   # PM2 config
└── setup-server.sh       # Setup script
```

## Security Considerations

1. **JWT Secret**: Never commit the actual `.env` file
2. **API Keys**: Keep ANTHROPIC_API_KEY secure
3. **Firewall**: Only expose necessary ports (80, 443, 3000)
4. **Updates**: Regularly update dependencies
5. **Backups**: Backup the database in `data/server/bbs.db`

## Updating Deployment

To deploy an update:

```bash
# Locally: Build new package
./deploy.sh

# Copy to server
scp baudagain-deploy.tar.gz do-dev:/tmp/

# On server: Extract and restart
cd ~/baudagain
tar -xzf /tmp/baudagain-deploy.tar.gz
npm install --production
pm2 restart baudagain
```

## Support

For issues or questions:
- Check logs: `pm2 logs baudagain`
- Review DEPLOYMENT_FIX_PLAN.md in project root
- Consult main README.md for project documentation
